{% macro ticket(_id, name, date, state, priority="Normal", description="", users=[]) %}
    <div class="col-md-6">
        <div id="ticket_{{ _id }}" class="panel border-left-lg border-left-primary">
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-8">
                        <h6 class="no-margin-top"><a href="task_manager_detailed.html">#{{ _id }}. {{ name }}</a></h6>
                        <p class="mb-15">{{ description }}</p>
                        {# default #}
                        <img src="../static/images/users/girl-placeholder.png" class="img-circle img-xs" alt="">
                        <img src="../static/images/users/man-placeholder.png" class="img-circle img-xs" alt="">
                        <img src="../static/images/users/woman-placeholder.png" class="img-circle img-xs" alt="">
                        {# end default #}
                        {% for user in users %}
                            <a href="#">
                                {# TODO user image and link
                            <img src="assets/images/demo/users/face1.jpg" class="img-circle img-xs" alt="">
                            <img src="assets/images/demo/users/face1.jpg" class="img-circle img-xs" alt="">
                             #}
                                User
                            </a>
                        {% endfor %}
                        <a href="#" class="text-default">&nbsp;<i class="icon-plus22"></i></a>
                    </div>

                    <div class="col-md-4">
                        <ul class="list task-details">
                            <li>{{ date }}</li>
                            <li class="dropdown">
                                Priority: &nbsp;
                                <a href="#" class="priority label dropdown-toggle" data-toggle="dropdown">{{ priority|capitalize}}

                                    <ul class="chose-priority dropdown-menu dropdown-menu-right active">
                                        <li><a class="chooser" href="#"><span class="highest status-mark position-left bg-danger"></span> Highest
                                            priority</a></li>
                                        <li><a class="chooser" href="#"><span class="high status-mark position-left bg-info"></span> High
                                            priority</a></li>
                                        <li><a class="chooser" href="#"><span class="normal status-mark position-left bg-primary"></span> Normal
                                            priority</a></li>
                                        <li><a class="chooser" href="#"><span class="low status-mark position-left bg-success"></span> Low
                                            priority</a></li>
                                    </ul>
                            </li>
                            <li><a href="#">Eternity app</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="panel-footer panel-footer-condensed"><a class="heading-elements-toggle"><i
                    class="icon-more"></i></a><a class="heading-elements-toggle"><i class="icon-more"></i></a>
                <div class="heading-elements">
                    <span class="heading-text">Due: <span class="text-semibold">23 hours</span></span>

                    <ul class="list-inline list-inline-condensed heading-text pull-right">
                        <li class="dropdown">
                            <a href="#" class="text-default dropdown-toggle" data-toggle="dropdown">Open
                                <span class="caret"></span></a>
                            <ul class="dropdown-menu dropdown-menu-right active">
                                <li class="active"><a href="#">{{ state|capitalize }}</a></li>
                                <li><a href="#">On hold</a></li>
                                <li><a href="#">Resolved</a></li>
                                <li><a href="#">Closed</a></li>
                                <li class="divider"></li>
                                <li><a href="#">Dublicate</a></li>
                                <li><a href="#">Invalid</a></li>
                                <li><a href="#">Wontfix</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="text-default dropdown-toggle" data-toggle="dropdown"><i
                                    class="icon-menu7"></i> <span class="caret"></span></a>
                            <ul class="dropdown-menu dropdown-menu-right">
                                <li><a href="#"><i class="icon-alarm-add"></i> Check in</a></li>
                                <li><a href="#"><i class="icon-attachment"></i> Attach screenshot</a>
                                </li>
                                <li><a href="#"><i class="icon-rotate-ccw2"></i> Reassign</a></li>
                                <li class="divider"></li>
                                <li><a href="#"><i class="icon-pencil7"></i> Edit task</a></li>
                                <li><a href="#"><i class="icon-cross2"></i> Remove</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function(e){



            var $root = $('#ticket_{{ _id }}');

            var priority = 0 || '{{ priority|capitalize }}';

            function change_priority(newvalue) {

                newvalue = newvalue.toString().capitalize();

                var     $priority = $root.find('.priority:first'),
                        prior_class = {
                            'Highest': '-danger',
                            'High': '-info',
                            'Normal': '-primary',
                            'Low': '-success'
                        };

                $.each(prior_class, function(_, v){
                    $root.removeClass('border-left' + v);
                    $priority.removeClass('label' + v);

                });

                $priority.html(newvalue + '<span class="caret"></span></a>').addClass('label' + prior_class[newvalue]);
                $root.addClass('border-left' + prior_class[newvalue]);

                console.log('------------');
                console.log($priority.html());

                return true;
            }

            $root.find('.chose-priority li span.highest').parents('a:first').data("priority", 'Highest');
            $root.find('.chose-priority li span.high').parents('a:first').data("priority", 'High');
            $root.find('.chose-priority li span.normal').parents('a:first').data("priority", 'Normal');
            $root.find('.chose-priority li span.low').parents('a:first').data("priority", 'Low');

            console.log(priority);
            change_priority(priority);

            $root.find('.{{ priority|lower }}').parents('li:first').addClass('active');

            $root.find('.chose-priority li').click(function(){
                console.log($(this).find('a.chooser').data('priority'));
                change_priority($(this).find('a.chooser').data('priority'));
            })




        })
    </script>
{% endmacro %}


